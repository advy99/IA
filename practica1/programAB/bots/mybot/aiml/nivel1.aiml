<?xml version="1.0" encoding="UTF-8"?>
<aiml version="2.0">


   <category>
      <pattern>[introduce aniade] (la serie) * a (la plataforma) (amazon) * </pattern>
      <template>

         <addtoset>
            <name>series<star index="2"/></name>
            <key><star/></key>
         </addtoset>

         <!-- Creamos el map donde estara la serie -->
         <system>touch bots/mybot/maps/<star/>.txt</system>
         <!-- Recargamos los archivos de aiml - actualmente no funciona, hay que reiniciar manualmente el bot -->
         <learn>./bots/mybot/aiml/*.aiml</learn>
         <learn>./bots/mybot/maps/<star/>.txt</learn>

         <!-- Almacenamos en variables globales la serie y plataforma, para preguntar sobre estas -->
         <think> <set name="serie"><star/></set> </think>
         <think> <set name="plataforma"><star index="2"/></set> </think>
         <think> <set name="topic">addgenero</set> </think>

         <!-- AÃ±adimos serie y plataforma al fichero de la serie -->
         <addtomap>
            <name><get name="serie"/></name>
            <key>Serie</key>
            <value><get name="serie"/></value>
         </addtomap>
         <addtomap>
            <name><get name="serie"/></name>
            <key>Plataforma</key>
            <value><get name="plataforma"/></value>
         </addtomap>

         Se ha introducido la serie <star/>, se deberia haber creado el fichero bots/mybot/maps/<star/>.txt. De no ser asi, genere el fichero manualmente, por favor.

         Dime el genero de la serie <star/>.

      </template>
   </category>


   <topic name="addatributo">
      <category>
         <pattern>ADDATRIBUTO * A *</pattern>
         <template>
            <think>
               <set var="atributo"> <map><name><get name="serie"/></name><star index="2"/></map> </set>
               <set var="nuevo_atributo"><star/></set>

               <condition var="atributo">
                  <li value="unknown">
                     <addtomap>
                        <name><get name="serie"/></name>
                        <key><star index="2"/></key>
                        <value><get var="nuevo_atributo"/></value>
                     </addtomap>
                     <set var="mensaje">Aniadido</set>
                  </li>

                  <li>
                     <set var="mensaje">Ese genero ya esta asignado</set>
                     <set var="esta"><srai>FINDITEM <get var="nuevo_atributo"/> IN <srai>DECODELIST <get var="atributo"/></srai></srai></set>

                     <condition var="esta">
                        <li value="0">
                           <modifymap>
                              <name><get name="serie"/></name>
                              <key><star index="2"/></key>
                              <value><get var="atributo"/>@<get var="nuevo_atributo"/></value>
                           </modifymap>
                           <set var="mensaje">Anadido</set>
                        </li>
                     </condition>
                  </li>

               </condition>
               <set name="topic"></set>
            </think>
            <get var="mensaje"/>
         </template>

      </category>


   </topic>

   <category>
      <pattern>[aniade incluye] el genero <set>generos</set> a (la serie) [<set>seriesnetflix</set> <set>seriesprimevideo</set> ] ^ </pattern>
      <template>
         <think> <set name="serie"><star index="2"/></set> </think>
         <think> <set name="topic">addatributo</set> </think>
         <srai>ADDATRIBUTO <star/> A genero </srai>
      </template>
   </category>

   <category>
      <pattern>[aniade incluye] el genero * a (la serie) [<set>seriesnetflix</set> <set>seriesprimevideo</set> ] ^ </pattern>
      <template>
         No se reconoce el genero a aniadir
      </template>
   </category>
   <category>
      <pattern>[aniade incluye] el genero <set>generos</set> a (la serie) * </pattern>
      <template>
         La serie <star index="2"/> no esta disponible
      </template>
   </category>



   <category>
      <pattern>[aniade incluye] el idioma <set>idiomas</set> a (la serie) [<set>seriesnetflix</set> <set>seriesprimevideo</set> ] ^ </pattern>
      <template>
         <think> <set name="serie"><star index="2"/></set> </think>
         <think> <set name="topic">addatributo</set> </think>
         <srai>ADDATRIBUTO <star/> A idiomas</srai>
      </template>
   </category>

   <category>
      <pattern>[aniade incluye] el idioma * a (la serie) [<set>seriesnetflix</set> <set>seriesprimevideo</set> ] ^ </pattern>
      <template>
         No se reconoce el idioma a aniadir
      </template>
   </category>

   <category>
      <pattern>[aniade incluye] el idioma <set>idiomas</set> a (la serie) * </pattern>
      <template>
         La serie <star index="2"/> no esta disponible
      </template>
   </category>

   <category>
      <pattern>[aniade incluye] los subtitulos (de) <set>idiomas</set> a (la serie) [<set>seriesnetflix</set> <set>seriesprimevideo</set> ] ^ </pattern>
      <template>
         <think> <set name="serie"><star index="2"/></set> </think>
         <think> <set name="topic">addatributo</set> </think>
         <srai>ADDATRIBUTO <star/> A subtitulos</srai>
      </template>
   </category>

   <category>
      <pattern>[aniade incluye] los subtitulos (de) * a (la serie) [<set>seriesnetflix</set> <set>seriesprimevideo</set> ] ^ </pattern>
      <template>
         No se reconoce el idioma a aniadir
      </template>
   </category>

   <category>
      <pattern>[aniade incluye] los subtitulos (de) <set>idiomas</set> a (la serie) * </pattern>
      <template>
         La serie <star index="2"/> no esta disponible
      </template>
   </category>


   <category>
      <pattern>[aniade include] un capitulo a (la serie) *</pattern>
      <template></template>
   </category>




   <category>
      <pattern>[sobre de] que [trata habla] (la serie) *</pattern>
      <template>de que va la serie <star/></template>
   </category>



   <category>
      <pattern> De que va (la serie) * </pattern>
      <template>
         <srai>decode <map><name><star/></name>sinopsis</map></srai>
      </template>
   </category>





   <category>
	<pattern> decodelist * </pattern>
	<template>
	  <think>
		<set var="palabra"></set>
		<set var="solucion"></set>
		<set var="tmp"><star/></set>
		<set var="tmp"> <explode><get var="tmp"/></explode> </set>
		<set var="caracter"><first><get var="tmp"/></first></set>
		<set var="tmp"><rest><get var="tmp"/></rest></set>
		<condition var="caracter">
			<li value="NIL">
				<set var="solucion"><get var="solucion"/> <get var="palabra"/></set>
			</li>
			<li value="@">
				<set var="solucion"><get var="solucion"/> <get var="palabra"/></set>
				<set var="palabra"></set>
				<set var="caracter"><first><get var="tmp"/></first></set>
				<set var="tmp"><rest><get var="tmp"/></rest></set>
				<loop/>
			</li>
			<li>
				<set var="palabra"><get var="palabra"/><get var="caracter"/></set>
				<set var="caracter"><first><get var="tmp"/></first></set>
				<set var="tmp"><rest><get var="tmp"/></rest></set>
				<loop/>
			</li>
		</condition>
	  </think>
	<get var="solucion"/>
	</template>
	</category>


</aiml>
